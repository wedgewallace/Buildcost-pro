<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0c1220">
<title>BuildCost Pro</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='14' fill='%231a2332'/%3E%3Cg transform='translate(32,30)'%3E%3Cpolygon points='-20,-4 0,-18 20,-4' fill='none' stroke='%2360a5fa' stroke-width='2'/%3E%3Crect x='-14' y='-2' width='28' height='22' rx='2' fill='rgba(56,152,236,0.15)' stroke='%233898ec' stroke-width='1.5'/%3E%3Crect x='-4' y='8' width='8' height='12' rx='1' fill='rgba(56,152,236,0.2)' stroke='%2360a5fa' stroke-width='1'/%3E%3C/g%3E%3C/svg%3E">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body,#root{height:100%;width:100%}
body{background:#0c1220;font-family:'DM Sans','Segoe UI',system-ui,sans-serif}
#loading{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;color:#e8ecf1}
.spin{width:40px;height:40px;border:3px solid rgba(255,255,255,0.1);border-top-color:#3898ec;border-radius:50%;animation:sp .7s linear infinite;margin-bottom:16px}
@keyframes sp{to{transform:rotate(360deg)}}
.msg{color:rgba(255,255,255,0.4);font-size:14px}
.err{color:#f87171;font-size:13px;margin-top:16px;max-width:400px;text-align:center;line-height:1.6;display:none}
</style>
</head>
<body>
<div id="root"><div id="loading"><div class="spin"></div><div class="msg">Loading BuildCost Pro...</div><div class="err" id="err">Could not load. Check internet and refresh.</div></div></div>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const { useState, useEffect, useCallback } = React;

// ─── DATA ───────────────────────────────────────────────────────────────────
const REGIONS=[{id:"hallieford_va",label:"Hallieford, Virginia",waterfront:true,laborMult:1,permitBase:8500},{id:"hampton_roads_va",label:"Hampton Roads, VA",waterfront:false,laborMult:1.05,permitBase:7000},{id:"richmond_va",label:"Richmond, VA",waterfront:false,laborMult:1.08,permitBase:6500},{id:"nova_va",label:"Northern Virginia / DC Metro",waterfront:false,laborMult:1.35,permitBase:12000},{id:"chesapeake_va",label:"Chesapeake Bay Waterfront, VA",waterfront:true,laborMult:1.12,permitBase:9500},{id:"obx_nc",label:"Outer Banks, NC (Waterfront)",waterfront:true,laborMult:1.15,permitBase:10000},{id:"southeast_avg",label:"Southeast US (Average)",waterfront:false,laborMult:0.95,permitBase:5500},{id:"northeast_avg",label:"Northeast US (Average)",waterfront:false,laborMult:1.25,permitBase:9000},{id:"midwest_avg",label:"Midwest US (Average)",waterfront:false,laborMult:0.88,permitBase:4500},{id:"west_coast_avg",label:"West Coast US (Average)",waterfront:false,laborMult:1.40,permitBase:14000},{id:"mountain_west",label:"Mountain West US",waterfront:false,laborMult:1.10,permitBase:6000},{id:"custom",label:"Custom / Other Location",waterfront:false,laborMult:1.0,permitBase:6000}];
const FOUNDATION_TYPES=[{id:"slab",label:"Concrete Slab",costPerSqFt:8,description:"Poured concrete pad"},{id:"crawlspace",label:"Crawlspace",costPerSqFt:14,description:"Raised foundation"},{id:"crawlspace_encapsulated",label:"Encapsulated Crawlspace",costPerSqFt:19,description:"Sealed & conditioned"},{id:"full_basement",label:"Full Basement (Unfinished)",costPerSqFt:25,description:"Full-height, unfinished"},{id:"full_basement_finished",label:"Full Basement (Finished)",costPerSqFt:45,description:"Full basement with finishing"},{id:"pilings",label:"Pilings / Stilts (Waterfront)",costPerSqFt:30,description:"Elevated on pilings, flood zones"}];
const FRAMING=[{id:"2x4",label:"2x4 Standard Framing",costPerSqFt:12,rValue:"R-13",description:"Standard residential"},{id:"2x6",label:"2x6 Framing",costPerSqFt:16,rValue:"R-19 to R-21",description:"Better insulation"},{id:"2x6_advanced",label:"2x6 Advanced (OVE)",costPerSqFt:15,rValue:"R-21+",description:"Less thermal bridging"},{id:"icf",label:"ICF (Insulated Concrete Forms)",costPerSqFt:28,rValue:"R-25+",description:"Hurricane-resistant"},{id:"sips",label:"SIPs (Insulated Panels)",costPerSqFt:24,rValue:"R-24 to R-40",description:"Prefab, efficient"},{id:"steel",label:"Steel Frame",costPerSqFt:22,rValue:"Varies",description:"Non-combustible"}];
const ROOFING=[{id:"asphalt_3tab",label:"3-Tab Asphalt",costPerSqFt:3.5,lifespan:"15-20 yrs"},{id:"asphalt_arch",label:"Architectural Asphalt",costPerSqFt:5,lifespan:"25-30 yrs"},{id:"metal_standing",label:"Standing Seam Metal",costPerSqFt:10,lifespan:"40-70 yrs"},{id:"metal_corrugated",label:"Corrugated Metal",costPerSqFt:7.5,lifespan:"30-50 yrs"},{id:"slate",label:"Natural Slate",costPerSqFt:18,lifespan:"75-100+ yrs"},{id:"synthetic_slate",label:"Synthetic Slate",costPerSqFt:12,lifespan:"40-60 yrs"},{id:"clay_tile",label:"Clay Tile",costPerSqFt:15,lifespan:"50-100 yrs"},{id:"cedar_shake",label:"Cedar Shake",costPerSqFt:11,lifespan:"20-40 yrs"}];
const EXTERIOR_SIDING=[{id:"vinyl",label:"Vinyl Siding",costPerSqFt:4,description:"Low maintenance"},{id:"fiber_cement",label:"Fiber Cement (HardiPlank)",costPerSqFt:8,description:"Durable, fire-resistant"},{id:"wood_lap",label:"Wood Lap Siding",costPerSqFt:9,description:"Classic look"},{id:"cedar_shingle",label:"Cedar Shingle",costPerSqFt:11,description:"Natural beauty"},{id:"brick",label:"Brick Veneer",costPerSqFt:14,description:"Timeless"},{id:"stone_veneer",label:"Stone Veneer",costPerSqFt:18,description:"Upscale"},{id:"natural_stone",label:"Natural Stone",costPerSqFt:30,description:"Premium"},{id:"stucco",label:"Stucco",costPerSqFt:7,description:"Smooth or textured"},{id:"board_batten",label:"Board & Batten",costPerSqFt:10,description:"Modern farmhouse"}];
const WINDOWS=[{id:"vinyl_double",label:"Vinyl Double-Pane",costPerUnit:350,description:"Standard"},{id:"vinyl_triple",label:"Vinyl Triple-Pane",costPerUnit:550,description:"High efficiency"},{id:"wood_double",label:"Wood Double-Pane",costPerUnit:650,description:"Classic"},{id:"wood_triple",label:"Wood Triple-Pane",costPerUnit:900,description:"Premium"},{id:"fiberglass",label:"Fiberglass",costPerUnit:750,description:"Strong"},{id:"aluminum_clad",label:"Aluminum-Clad Wood",costPerUnit:850,description:"Low maintenance exterior"},{id:"impact",label:"Impact-Rated (Hurricane)",costPerUnit:1100,description:"Storm protection"}];
const FLOORING_OPTIONS=[{id:"lvp",label:"Luxury Vinyl Plank",costPerSqFt:4,description:"Water-resistant"},{id:"laminate",label:"Laminate",costPerSqFt:3,description:"Affordable"},{id:"engineered_hardwood",label:"Engineered Hardwood",costPerSqFt:8,description:"Real wood top"},{id:"solid_hardwood",label:"Solid Hardwood (Oak)",costPerSqFt:10,description:"Refinishable"},{id:"solid_hardwood_premium",label:"Solid Hardwood (Premium)",costPerSqFt:14,description:"Walnut/Cherry"},{id:"porcelain_tile",label:"Porcelain Tile",costPerSqFt:9,description:"Waterproof"},{id:"ceramic_tile",label:"Ceramic Tile",costPerSqFt:6,description:"Versatile"},{id:"natural_stone_tile",label:"Natural Stone Tile",costPerSqFt:16,description:"Marble, travertine"},{id:"carpet",label:"Carpet (Mid-Grade)",costPerSqFt:4,description:"Soft"},{id:"carpet_premium",label:"Carpet (Premium)",costPerSqFt:8,description:"Wool"},{id:"concrete_polished",label:"Polished Concrete",costPerSqFt:5,description:"Modern"},{id:"epoxy",label:"Epoxy (Garage)",costPerSqFt:6,description:"Durable"}];
const COUNTERTOP_OPTIONS=[{id:"laminate",label:"Laminate",costPerSqFt:15,description:"Budget"},{id:"butcher_block",label:"Butcher Block",costPerSqFt:40,description:"Warm wood"},{id:"granite",label:"Granite",costPerSqFt:60,description:"Natural stone"},{id:"quartz",label:"Quartz",costPerSqFt:70,description:"Non-porous"},{id:"marble",label:"Marble",costPerSqFt:85,description:"Elegant"},{id:"soapstone",label:"Soapstone",costPerSqFt:80,description:"Heat-resistant"},{id:"quartzite",label:"Quartzite",costPerSqFt:90,description:"Extremely hard"},{id:"concrete",label:"Concrete",costPerSqFt:65,description:"Custom shapes"},{id:"solid_surface",label:"Solid Surface (Corian)",costPerSqFt:45,description:"Seamless"}];
const CABINET_OPTIONS=[{id:"stock",label:"Stock Cabinets",costPerLinFt:150,description:"Pre-made"},{id:"semi_custom",label:"Semi-Custom",costPerLinFt:350,description:"Better quality"},{id:"custom",label:"Custom Cabinets",costPerLinFt:700,description:"Fully custom"},{id:"custom_premium",label:"Premium Custom (Inset)",costPerLinFt:1100,description:"Top-tier"}];
const APPLIANCE_PACKAGES=[{id:"basic",label:"Basic Package",cost:4000,description:"Whirlpool, GE"},{id:"mid",label:"Mid-Range",cost:8000,description:"KitchenAid, Bosch"},{id:"premium",label:"Premium",cost:15000,description:"Wolf, Sub-Zero"},{id:"luxury",label:"Luxury",cost:30000,description:"La Cornue, Gaggenau"}];
const PAINT_OPTIONS=[{id:"builder",label:"Builder Grade",costPerSqFt:1.5,description:"Basic, 1 coat"},{id:"mid",label:"Mid-Grade (Behr)",costPerSqFt:2.5,description:"2 coats"},{id:"premium",label:"Premium (BM/SW)",costPerSqFt:3.5,description:"Premium, 2 coats"},{id:"luxury",label:"Luxury (Farrow & Ball)",costPerSqFt:5,description:"Designer paint"}];
const MOLDING_OPTIONS=[{id:"none",label:"No Trim",costPerLinFt:0,description:"Clean lines"},{id:"basic",label:"Basic Baseboard",costPerLinFt:3,description:"MDF or pine"},{id:"mid",label:"Mid (5\" + crown)",costPerLinFt:6,description:"Profiled"},{id:"premium",label:"Premium (Full package)",costPerLinFt:14,description:"Crown+chair+wainscoting"},{id:"luxury",label:"Luxury (Coffered)",costPerLinFt:25,description:"Millwork"}];
const FIXTURE_LEVELS=[{id:"basic",label:"Basic Fixtures",costPerBath:1500,costPerHalfBath:800,description:"Chrome, builder"},{id:"mid",label:"Mid-Range",costPerBath:3500,costPerHalfBath:1800,description:"Moen/Delta"},{id:"premium",label:"Premium",costPerBath:7000,costPerHalfBath:3500,description:"Kohler/Grohe"},{id:"luxury",label:"Luxury",costPerBath:15000,costPerHalfBath:7000,description:"Waterworks"}];
const ELECTRICAL_LEVELS=[{id:"basic",label:"Basic (100-amp)",cost:12000,perSqFt:5,description:"Minimum code"},{id:"mid",label:"Mid (200-amp, recessed)",cost:18000,perSqFt:8,description:"Good lighting"},{id:"premium",label:"Premium (smart home)",cost:28000,perSqFt:12,description:"Smart switches"},{id:"luxury",label:"Luxury (400-amp)",cost:45000,perSqFt:18,description:"Full automation"}];
const HVAC_OPTIONS=[{id:"central_basic",label:"Central HVAC (Standard)",costPerSqFt:5,description:"Basic forced air"},{id:"central_high",label:"Central HVAC (High Eff.)",costPerSqFt:7,description:"16+ SEER"},{id:"heat_pump",label:"Heat Pump",costPerSqFt:8,description:"Efficient"},{id:"mini_split",label:"Mini-Splits",costPerSqFt:10,description:"Zone control"},{id:"geothermal",label:"Geothermal",costPerSqFt:18,description:"Ground-source"},{id:"radiant_floor",label:"Radiant Floor + AC",costPerSqFt:15,description:"In-floor heating"}];
const DRIVEWAY_OPTIONS=[{id:"gravel",label:"Gravel",costPerLinFt:12,description:"Rural"},{id:"asphalt",label:"Asphalt",costPerLinFt:25,description:"Standard"},{id:"concrete",label:"Concrete",costPerLinFt:40,description:"Durable"},{id:"stamped_concrete",label:"Stamped Concrete",costPerLinFt:55,description:"Decorative"},{id:"pavers",label:"Pavers",costPerLinFt:70,description:"Premium"},{id:"heated",label:"Heated Pavers",costPerLinFt:120,description:"Snow-melting"}];
const WELL_SEPTIC=[{id:"municipal",label:"Municipal Water & Sewer",cost:8000,description:"Connection fees"},{id:"well_septic_basic",label:"Well + Standard Septic",cost:18000,description:"Conventional"},{id:"well_septic_advanced",label:"Well + Advanced Septic",cost:28000,description:"ATU"},{id:"well_septic_mound",label:"Well + Mound Septic",cost:32000,description:"High water table"},{id:"well_only",label:"Well Only (Municipal Sewer)",cost:10000,description:"Well + sewer"}];
const ROOM_TEMPLATES={kitchen:{label:"Kitchen",sqFt:200,hasCountertops:true,hasCabinets:true,hasAppliances:true,hasFlooring:true},master_bed:{label:"Master Bedroom",sqFt:250,hasFlooring:true},master_bath:{label:"Master Bathroom",sqFt:120,hasCountertops:true,hasCabinets:true,hasFlooring:true,hasFixtures:true,isFullBath:true},bedroom2:{label:"Bedroom 2",sqFt:180,hasFlooring:true},bedroom3:{label:"Bedroom 3",sqFt:160,hasFlooring:true},bedroom4:{label:"Bedroom 4",sqFt:160,hasFlooring:true},bedroom5:{label:"Bedroom 5",sqFt:150,hasFlooring:true},bath2:{label:"Bathroom 2",sqFt:80,hasCountertops:true,hasCabinets:true,hasFlooring:true,hasFixtures:true,isFullBath:true},bath3:{label:"Bathroom 3",sqFt:70,hasCountertops:true,hasCabinets:true,hasFlooring:true,hasFixtures:true,isFullBath:true},half_bath:{label:"Half Bath",sqFt:35,hasCountertops:true,hasCabinets:true,hasFlooring:true,hasFixtures:true,isFullBath:false},half_bath2:{label:"Half Bath 2",sqFt:35,hasCountertops:true,hasCabinets:true,hasFlooring:true,hasFixtures:true,isFullBath:false},living_room:{label:"Living Room",sqFt:300,hasFlooring:true},family_room:{label:"Family Room",sqFt:250,hasFlooring:true},dining_room:{label:"Dining Room",sqFt:180,hasFlooring:true},office:{label:"Home Office",sqFt:150,hasFlooring:true},laundry:{label:"Laundry Room",sqFt:80,hasFlooring:true},mudroom:{label:"Mudroom",sqFt:60,hasFlooring:true},pantry:{label:"Walk-in Pantry",sqFt:50,hasFlooring:true},garage_2car:{label:"2-Car Garage",sqFt:500,hasFlooring:true,isGarage:true},garage_3car:{label:"3-Car Garage",sqFt:750,hasFlooring:true,isGarage:true},bonus_room:{label:"Bonus Room",sqFt:300,hasFlooring:true},sunroom:{label:"Sunroom",sqFt:200,hasFlooring:true}};
const COMPATIBLE_SITES=["architecturaldesigns.com","houseplans.com","floorplans.com","eplans.com","homeplans.com","coolhouseplans.com","familyhomeplans.com","thehousedesigners.com","dreamhomesource.com","builderhouseplans.com","monster-house-plans.com","dongardner.com","frankbetz.com","nelsondesigngroup.com","southernliving.com/house-plans","bhg.com/home-improvement/house-plans"];
const STEPS=[{id:"basics",label:"Basics",icon:"1"},{id:"exterior",label:"Exterior",icon:"2"},{id:"rooms",label:"Rooms",icon:"3"},{id:"finishes",label:"Finishes",icon:"4"},{id:"systems",label:"Systems",icon:"5"},{id:"summary",label:"Summary",icon:"6"}];

const fmt=(n)=>{if(n==null||isNaN(n))return"$0";return"$"+Math.round(n).toLocaleString("en-US")};
const uid=()=>Math.random().toString(36).substr(2,9);
const SK="buildcost_projects";
const saveProjects=async(p)=>{try{localStorage.setItem(SK,JSON.stringify(p))}catch(e){}};
const loadProjects=async()=>{try{const d=localStorage.getItem(SK);return d?JSON.parse(d):[]}catch(e){return[]}};

// ─── ICONS ──────────────────────────────────────────────────────────────────
const HomeIcon=({size=24})=><svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;
const PlusIcon=({size=20})=><svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
const HammerIcon=({size=20})=><svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><path d="M15 12l-8.5 8.5a2.12 2.12 0 01-3-3L12 9"/><path d="M17.64 15L22 10.64"/><path d="M20.91 11.7l-1.25-1.25a2.12 2.12 0 00-3 0L15 12"/><path d="M13.09 7.91l1.25 1.25"/><path d="M11.5 6.5L9 4"/><path d="M7 2l1 4 4 1"/></svg>;
const LinkIcon=({size=20})=><svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>;
const ChevronRight=({size=16})=><svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round"><polyline points="9 18 15 12 9 6"/></svg>;
const ChevronLeft=({size=16})=><svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round"><polyline points="15 18 9 12 15 6"/></svg>;
const TrashIcon=({size=18})=><svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>;
const SaveIcon=({size=18})=><svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>;
const ClipboardIcon=({size=18})=><svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><rect x="9" y="2" width="6" height="4" rx="1"/><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/></svg>;
const CheckIcon=({size=16})=><svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round"><polyline points="20 6 9 17 4 12"/></svg>;
const MapPinIcon=({size=18})=><svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>;

// ─── STYLES ─────────────────────────────────────────────────────────────────
const S={app:{minHeight:"100vh",background:"linear-gradient(165deg,#0c1220 0%,#1a2332 30%,#0f1923 70%,#0c1220 100%)",color:"#e8ecf1",fontFamily:"'DM Sans','Segoe UI',system-ui,sans-serif",position:"relative"},bg:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"radial-gradient(ellipse at 20% 0%,rgba(56,152,236,0.08) 0%,transparent 60%),radial-gradient(ellipse at 80% 100%,rgba(168,85,247,0.05) 0%,transparent 50%)",pointerEvents:"none",zIndex:0},ct:{maxWidth:960,margin:"0 auto",padding:"0 20px",position:"relative",zIndex:1},hd:{padding:"28px 0 20px",display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid rgba(255,255,255,0.06)",marginBottom:24},lg:{display:"flex",alignItems:"center",gap:12,cursor:"pointer"},li:{width:44,height:44,borderRadius:12,background:"linear-gradient(135deg,#3898ec,#6c5ce7)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",boxShadow:"0 4px 15px rgba(56,152,236,0.3)"},lt:{fontSize:20,fontWeight:700,color:"#fff"},ls:{fontSize:11,color:"rgba(255,255,255,0.4)",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.04em"},cd:{background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:16,padding:24,marginBottom:16},bt:{padding:"12px 24px",borderRadius:10,border:"none",fontFamily:"inherit",fontSize:14,fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:8},bp:{background:"linear-gradient(135deg,#3898ec,#6c5ce7)",color:"white",boxShadow:"0 4px 15px rgba(56,152,236,0.3)"},bs:{background:"rgba(255,255,255,0.08)",color:"#e8ecf1",border:"1px solid rgba(255,255,255,0.12)"},bd:{background:"rgba(239,68,68,0.15)",color:"#f87171",border:"1px solid rgba(239,68,68,0.2)"},bsm:{padding:"8px 16px",fontSize:13},ip:{width:"100%",padding:"12px 16px",borderRadius:10,background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",color:"#e8ecf1",fontFamily:"inherit",fontSize:14,outline:"none",boxSizing:"border-box"},lb:{display:"block",fontSize:13,fontWeight:600,color:"rgba(255,255,255,0.6)",marginBottom:6,textTransform:"uppercase",letterSpacing:"0.05em"},st:{fontSize:18,fontWeight:700,color:"#fff",marginBottom:16,display:"flex",alignItems:"center",gap:10},bg1:{display:"inline-flex",alignItems:"center",padding:"4px 10px",borderRadius:6,fontSize:11,fontWeight:600},bb:{background:"rgba(56,152,236,0.15)",color:"#60a5fa"},bgr:{background:"rgba(34,197,94,0.15)",color:"#4ade80"},bpu:{background:"rgba(168,85,247,0.15)",color:"#c084fc"},ba:{background:"rgba(245,158,11,0.15)",color:"#fbbf24"},og:{display:"grid",gap:10},oi:{padding:"14px 16px",borderRadius:10,background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.08)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},oa:{background:"rgba(56,152,236,0.12)",borderColor:"rgba(56,152,236,0.4)",boxShadow:"0 0 0 1px rgba(56,152,236,0.2)"},tb:{background:"linear-gradient(135deg,rgba(56,152,236,0.1),rgba(108,92,231,0.1))",border:"1px solid rgba(56,152,236,0.2)",borderRadius:16,padding:"20px 24px",display:"flex",alignItems:"center",justifyContent:"space-between"},cl:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.04)"},pb:{height:4,borderRadius:2,background:"rgba(255,255,255,0.08)",overflow:"hidden",marginBottom:24},pf:{height:"100%",borderRadius:2,background:"linear-gradient(90deg,#3898ec,#6c5ce7)"},sd:{width:32,height:32,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:13,fontWeight:700,cursor:"pointer"},sa:{background:"linear-gradient(135deg,#3898ec,#6c5ce7)",color:"white"},sdn:{background:"rgba(34,197,94,0.2)",color:"#4ade80"},sp:{background:"rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.3)"}};

// ─── COMPONENTS ─────────────────────────────────────────────────────────────
const OptSel=({options,value,onChange,cols=1})=><div style={{...S.og,gridTemplateColumns:`repeat(${Math.min(cols,2)},1fr)`}}>{options.map(o=>{const a=value===o.id;const cs=o.costPerSqFt?fmt(o.costPerSqFt)+"/sf":o.costPerUnit?fmt(o.costPerUnit)+"/ea":o.costPerLinFt?fmt(o.costPerLinFt)+"/lf":o.costPerBath?fmt(o.costPerBath)+"/bath":o.cost?fmt(o.cost):o.perSqFt?fmt(o.perSqFt)+"/sf":"";return<div key={o.id} onClick={()=>onChange(o.id)} style={{...S.oi,...(a?S.oa:{})}}><div style={{flex:1,minWidth:0}}><div style={{fontSize:14,fontWeight:600,color:a?"#60a5fa":"#e8ecf1",marginBottom:2}}>{o.label}</div>{o.description&&<div style={{fontSize:12,color:"rgba(255,255,255,0.4)",lineHeight:1.4}}>{o.description}</div>}{o.rValue&&<div style={{fontSize:11,color:"rgba(56,152,236,0.7)",marginTop:2}}>{o.rValue}</div>}{o.lifespan&&<div style={{fontSize:11,color:"rgba(56,152,236,0.7)",marginTop:2}}>{o.lifespan}</div>}</div><div style={{textAlign:"right",marginLeft:12}}>{cs&&<div style={{fontSize:14,fontWeight:700,color:a?"#60a5fa":"rgba(255,255,255,0.6)"}}>{cs}</div>}{a&&<div style={{marginTop:4}}><span style={{...S.bg1,...S.bgr,fontSize:10}}>SELECTED</span></div>}</div></div>})}</div>;

const RoomCfg=({room,onChange,onRemove})=>{const[ex,setEx]=useState(false);return<div style={{...S.cd,padding:16,marginBottom:10}}><div style={{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer"}} onClick={()=>setEx(!ex)}><div style={{display:"flex",alignItems:"center",gap:10}}><span style={{fontSize:15,fontWeight:600,color:"#fff"}}>{room.label}</span><span style={{...S.bg1,...S.bb}}>{room.sqFt} sf</span></div><span style={{fontSize:13,color:"rgba(255,255,255,0.5)"}}>{ex?"▾":"▸"}</span></div>{ex&&<div style={{marginTop:16,paddingTop:16,borderTop:"1px solid rgba(255,255,255,0.06)"}}><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16}}><div><label style={S.lb}>Name</label><input style={S.ip} value={room.label} onChange={e=>onChange({...room,label:e.target.value})}/></div><div><label style={S.lb}>Sq Ft</label><input style={S.ip} type="number" value={room.sqFt} onChange={e=>onChange({...room,sqFt:parseInt(e.target.value)||0})}/></div></div>{room.hasFlooring&&<div style={{marginBottom:16}}><label style={S.lb}>Flooring</label><OptSel options={room.isGarage?FLOORING_OPTIONS.filter(f=>["epoxy","concrete_polished","lvp"].includes(f.id)):FLOORING_OPTIONS} value={room.flooring} onChange={v=>onChange({...room,flooring:v})} cols={2}/></div>}{room.hasCountertops&&<div style={{marginBottom:16}}><label style={S.lb}>Countertops ({room.counterSqFt||30} sf)</label><input style={{...S.ip,width:120,marginBottom:10}} type="number" value={room.counterSqFt||30} onChange={e=>onChange({...room,counterSqFt:parseInt(e.target.value)||0})}/><OptSel options={COUNTERTOP_OPTIONS} value={room.countertop} onChange={v=>onChange({...room,countertop:v})} cols={2}/></div>}{room.hasCabinets&&<div style={{marginBottom:16}}><label style={S.lb}>Cabinets ({room.cabinetLinFt||8} lf)</label><input style={{...S.ip,width:120,marginBottom:10}} type="number" value={room.cabinetLinFt||8} onChange={e=>onChange({...room,cabinetLinFt:parseInt(e.target.value)||0})}/><OptSel options={CABINET_OPTIONS} value={room.cabinets} onChange={v=>onChange({...room,cabinets:v})}/></div>}{room.hasAppliances&&<div style={{marginBottom:16}}><label style={S.lb}>Appliances</label><OptSel options={APPLIANCE_PACKAGES} value={room.appliances} onChange={v=>onChange({...room,appliances:v})}/></div>}{room.hasFixtures&&<div style={{marginBottom:16}}><label style={S.lb}>Fixtures</label><OptSel options={FIXTURE_LEVELS} value={room.fixtures} onChange={v=>onChange({...room,fixtures:v})}/></div>}<button onClick={e=>{e.stopPropagation();onRemove()}} style={{...S.bt,...S.bd,...S.bsm,marginTop:8}}><TrashIcon size={14}/> Remove</button></div>}</div>};

// ─── MAIN APP ───────────────────────────────────────────────────────────────
function App(){
  const[scr,setScr]=useState("splash");const[pjs,setPjs]=useState([]);const[P,setP]=useState(null);const[stp,setStp]=useState(0);const[urlInput,setUrlInput]=useState("");const[urlError,setUrlError]=useState("");
  useEffect(()=>{(async()=>{setPjs(await loadProjects())})()},[]);
  const autoSave=useCallback(async(proj)=>{const u=pjs.map(p=>p.id===proj.id?proj:p);if(!u.find(p=>p.id===proj.id))u.push(proj);setPjs(u);await saveProjects(u)},[pjs]);
  const genRooms=(proj)=>{const r=[];const add=(tid)=>{const t=ROOM_TEMPLATES[tid];r.push({id:uid(),templateId:tid,label:t.label,sqFt:t.sqFt,hasFlooring:t.hasFlooring,hasCountertops:t.hasCountertops,hasCabinets:t.hasCabinets,hasAppliances:t.hasAppliances,hasFixtures:t.hasFixtures,isFullBath:t.isFullBath,isGarage:t.isGarage,flooring:t.isGarage?"epoxy":(t.hasFixtures?"porcelain_tile":"engineered_hardwood"),countertop:t.hasCountertops?(tid==="kitchen"?"quartz":"granite"):null,cabinets:t.hasCabinets?(tid==="kitchen"?"semi_custom":"stock"):null,cabinetLinFt:t.hasCabinets?(tid==="kitchen"?25:8):0,counterSqFt:t.hasCountertops?(tid==="kitchen"?40:15):0,appliances:t.hasAppliances?"mid":null,fixtures:t.hasFixtures?"mid":null})};add("kitchen");add("living_room");add("dining_room");add("master_bed");add("master_bath");for(let i=2;i<=Math.min(proj.bedrooms,5);i++)add("bedroom"+i);for(let i=2;i<=Math.min(proj.bathrooms,3);i++)add("bath"+i);for(let i=0;i<Math.min(proj.halfBaths,2);i++)add(i===0?"half_bath":"half_bath2");add("laundry");if(proj.totalSqFt>2000)add("office");add("garage_2car");return r};
  const newProj=(planData={})=>{const p={id:uid(),name:planData.name||"New Home Build",createdAt:new Date().toISOString(),url:planData.url||"",totalSqFt:planData.sqFt||2400,stories:planData.stories||1,bedrooms:planData.bedrooms||3,bathrooms:planData.bathrooms||2,halfBaths:planData.halfBaths||1,region:"hallieford_va",isWaterfront:true,customLaborMult:1,foundation:"crawlspace",framing:"2x6",roofing:"asphalt_arch",roofSqFt:Math.round((planData.sqFt||2400)*1.15),siding:"fiber_cement",windows:"vinyl_double",windowCount:planData.windowCount||18,exteriorDoors:3,garageDoors:planData.garageDoors||2,rooms:[],paint:"mid",molding:"mid",interiorDoors:planData.interiorDoors||14,interiorDoorCost:250,electrical:"mid",hvac:"central_high",plumbing:12000,insulation:6000,driveway:"gravel",drivewayLength:200,wellSeptic:"well_septic_basic",permitCost:null,inspectionCost:3000,architectCost:null,notes:""};p.rooms=genRooms(p);setP(p);autoSave(p);setStp(0);setScr("builder")};
  const parseUrl=()=>{setUrlError("");if(!urlInput.trim()){setUrlError("Please enter a URL");return}let hostname;try{hostname=new URL(urlInput.includes("://")?urlInput:"https://"+urlInput).hostname.replace("www.","")}catch(e){setUrlError("Invalid URL format");return}const compatible=COMPATIBLE_SITES.some(s=>hostname.includes(s.split("/")[0]));if(!compatible){setUrlError("Site not yet supported. Compatible: architecturaldesigns.com, houseplans.com, eplans.com, and more. You can use Manual Input instead.");return}newProj({name:"Plan from "+hostname,url:urlInput,sqFt:2600,stories:2,bedrooms:4,bathrooms:3,halfBaths:1,windowCount:22,garageDoors:2,interiorDoors:18})};
  const up=(u)=>{const n={...P,...u};setP(n);autoSave(n)};
  const upRoom=(rid,ur)=>up({rooms:P.rooms.map(r=>r.id===rid?ur:r)});
  const rmRoom=(rid)=>up({rooms:P.rooms.filter(r=>r.id!==rid)});
  const addRoom=(tid)=>{const t=ROOM_TEMPLATES[tid];up({rooms:[...P.rooms,{id:uid(),templateId:tid,label:t.label,sqFt:t.sqFt,hasFlooring:t.hasFlooring,hasCountertops:t.hasCountertops,hasCabinets:t.hasCabinets,hasAppliances:t.hasAppliances,hasFixtures:t.hasFixtures,isFullBath:t.isFullBath,isGarage:t.isGarage,flooring:t.isGarage?"epoxy":"engineered_hardwood",countertop:t.hasCountertops?"quartz":null,cabinets:t.hasCabinets?"semi_custom":null,cabinetLinFt:t.hasCabinets?15:0,counterSqFt:t.hasCountertops?20:0,appliances:t.hasAppliances?"mid":null,fixtures:t.hasFixtures?"mid":null}]})};
  const delProj=async(id)=>{const u=pjs.filter(p=>p.id!==id);setPjs(u);await saveProjects(u)};

  const calc=()=>{if(!P)return{};const p=P,reg=REGIONS.find(r=>r.id===p.region)||REGIONS[0],lm=p.region==="custom"?(p.customLaborMult||1):reg.laborMult,wm=p.isWaterfront?1.15:1,sq=p.totalSqFt||2400,c={};let f;
  f=FOUNDATION_TYPES.find(x=>x.id===p.foundation);c.foundation={label:f?.label||"Foundation",cost:(f?.costPerSqFt||14)*sq*lm*wm};
  f=FRAMING.find(x=>x.id===p.framing);c.framing={label:f?.label||"Framing",cost:(f?.costPerSqFt||16)*sq*lm};
  f=ROOFING.find(x=>x.id===p.roofing);c.roofing={label:f?.label||"Roofing",cost:(f?.costPerSqFt||5)*(p.roofSqFt||sq*1.15)*lm};
  f=EXTERIOR_SIDING.find(x=>x.id===p.siding);c.siding={label:f?.label||"Siding",cost:(f?.costPerSqFt||8)*sq*1.1*lm};
  f=WINDOWS.find(x=>x.id===p.windows);c.windows={label:f?.label||"Windows",cost:(f?.costPerUnit||500)*(p.windowCount||18)*lm};
  c.exteriorDoors={label:"Ext. Doors",cost:(p.exteriorDoors||3)*1200*lm};c.garageDoors={label:"Garage Doors",cost:(p.garageDoors||2)*1500*lm};
  let rt=0;const rb=[];(p.rooms||[]).forEach(r=>{let rc=0;const it=[];
  if(r.hasFlooring&&r.flooring){f=FLOORING_OPTIONS.find(x=>x.id===r.flooring);const v=(f?.costPerSqFt||5)*r.sqFt*lm;rc+=v;it.push({label:"Floor: "+(f?.label||""),cost:v})}
  if(r.hasCountertops&&r.countertop){f=COUNTERTOP_OPTIONS.find(x=>x.id===r.countertop);const v=(f?.costPerSqFt||50)*(r.counterSqFt||30)*lm;rc+=v;it.push({label:"Counter: "+(f?.label||""),cost:v})}
  if(r.hasCabinets&&r.cabinets){f=CABINET_OPTIONS.find(x=>x.id===r.cabinets);const v=(f?.costPerLinFt||300)*(r.cabinetLinFt||10)*lm;rc+=v;it.push({label:"Cabs: "+(f?.label||""),cost:v})}
  if(r.hasAppliances&&r.appliances){f=APPLIANCE_PACKAGES.find(x=>x.id===r.appliances);const v=f?.cost||8000;rc+=v;it.push({label:"Appl: "+(f?.label||""),cost:v})}
  if(r.hasFixtures&&r.fixtures){f=FIXTURE_LEVELS.find(x=>x.id===r.fixtures);const v=(r.isFullBath?(f?.costPerBath||3000):(f?.costPerHalfBath||1500))*lm;rc+=v;it.push({label:"Fix: "+(f?.label||""),cost:v})}
  rt+=rc;rb.push({label:r.label,cost:rc,items:it})});
  c.rooms={label:"Room Finishes",cost:rt};
  f=PAINT_OPTIONS.find(x=>x.id===p.paint);c.paint={label:"Paint: "+(f?.label||""),cost:(f?.costPerSqFt||2.5)*sq*3.2*lm};
  f=MOLDING_OPTIONS.find(x=>x.id===p.molding);c.molding={label:"Trim: "+(f?.label||""),cost:(f?.costPerLinFt||6)*sq*1.5*lm};
  c.intDoors={label:"Int. Doors",cost:(p.interiorDoors||14)*(p.interiorDoorCost||250)*lm};
  f=ELECTRICAL_LEVELS.find(x=>x.id===p.electrical);c.electrical={label:"Electrical: "+(f?.label||""),cost:((f?.cost||18000)+(f?.perSqFt||8)*sq)*lm};
  f=HVAC_OPTIONS.find(x=>x.id===p.hvac);c.hvac={label:"HVAC: "+(f?.label||""),cost:(f?.costPerSqFt||7)*sq*lm};
  c.plumbing={label:"Plumbing",cost:(p.plumbing||12000)*lm};c.insulation={label:"Insulation",cost:(p.insulation||6000)*lm};
  f=DRIVEWAY_OPTIONS.find(x=>x.id===p.driveway);c.driveway={label:"Driveway: "+(f?.label||""),cost:(f?.costPerLinFt||25)*(p.drivewayLength||200)*lm};
  f=WELL_SEPTIC.find(x=>x.id===p.wellSeptic);c.wellSeptic={label:"Water/Sewer: "+(f?.label||""),cost:(f?.cost||18000)*lm*wm};
  c.permits={label:"Permits",cost:p.permitCost??(reg.permitBase*wm)};c.inspections={label:"Inspections",cost:p.inspectionCost||3000};c.architect={label:"Architect",cost:p.architectCost??(sq*5)};c.siteWork={label:"Site Work",cost:sq*3*lm*wm};
  const tot=Object.values(c).reduce((s,x)=>s+(x.cost||0),0);return{costs:c,total:tot,perSqFt:sq>0?tot/sq:0,roomBreakdown:rb}};

  const{costs,total,perSqFt,roomBreakdown}=P?calc():{};

  if(scr==="splash")return<div style={S.app}><div style={S.bg}/><div style={{...S.ct,paddingTop:60,paddingBottom:60,textAlign:"center"}}><div onClick={()=>setScr("home")} style={{width:100,height:100,borderRadius:24,margin:"0 auto 24px",background:"linear-gradient(135deg,#3898ec,#6c5ce7)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 8px 40px rgba(56,152,236,0.4)"}}><HomeIcon size={48}/></div><h1 style={{fontSize:32,fontWeight:800,color:"#fff",margin:"0 0 8px"}}>BuildCost Pro</h1><p style={{fontSize:16,color:"rgba(255,255,255,0.5)",margin:"0 auto 32px",maxWidth:400,lineHeight:1.5}}>Home build cost estimator. Foundation to finishing touches.</p><button onClick={()=>setScr("home")} style={{...S.bt,...S.bp,fontSize:16,padding:"14px 40px"}}>Get Started</button></div></div>;

  if(scr==="home")return<div style={S.app}><div style={S.bg}/><div style={S.ct}><div style={S.hd}><div style={S.lg} onClick={()=>setScr("splash")}><div style={S.li}><HomeIcon size={22}/></div><div><div style={S.lt}>BuildCost Pro</div><div style={S.ls}>Home Build Estimator</div></div></div></div><div style={{marginBottom:24}}><h2 style={{fontSize:22,fontWeight:700,color:"#fff",margin:"0 0 8px"}}>Start a New Estimate</h2><p style={{color:"rgba(255,255,255,0.4)",fontSize:14,margin:0}}>Import from a house plan website or build from scratch</p></div>
  <div style={{...S.cd,marginBottom:12}}><div style={{display:"flex",alignItems:"center",gap:10,marginBottom:12}}><LinkIcon size={18}/><span style={{fontSize:15,fontWeight:600,color:"#fff"}}>Import from Plan URL</span><span style={{...S.bg1,...S.bb}}>RECOMMENDED</span></div><div style={{display:"flex",gap:10,marginBottom:8}}><input style={{...S.ip,flex:1}} placeholder="Paste URL from architecturaldesigns.com, houseplans.com, etc." value={urlInput} onChange={e=>{setUrlInput(e.target.value);setUrlError("")}} onKeyDown={e=>e.key==="Enter"&&parseUrl()}/><button onClick={parseUrl} style={{...S.bt,...S.bp,whiteSpace:"nowrap"}}>Import</button></div>{urlError&&<div style={{fontSize:13,color:"#f87171",marginTop:4}}>{urlError}</div>}<div style={{fontSize:12,color:"rgba(255,255,255,0.3)",marginTop:8,lineHeight:1.5}}>Compatible: {COMPATIBLE_SITES.slice(0,6).join(", ")}, and {COMPATIBLE_SITES.length-6} more</div></div>
  <div style={{...S.cd,cursor:"pointer"}} onClick={()=>newProj()}><div style={{display:"flex",alignItems:"center",gap:10}}><HammerIcon size={18}/><span style={{fontSize:15,fontWeight:600,color:"#fff"}}>Build from Scratch</span><span style={{...S.bg1,...S.bpu}}>MANUAL</span></div><p style={{color:"rgba(255,255,255,0.4)",fontSize:13,margin:"8px 0 0"}}>Enter specs, rooms, finishes, and more.</p></div>{pjs.length>0&&<div style={{marginTop:32}}><h3 style={{fontSize:16,fontWeight:700,color:"#fff",marginBottom:12}}>Saved ({pjs.length})</h3>{pjs.map(pj=><div key={pj.id} style={{...S.cd,padding:16,marginBottom:8,display:"flex",alignItems:"center",justifyContent:"space-between"}}><div style={{flex:1,cursor:"pointer"}} onClick={()=>{setP(pj);setStp(0);setScr("builder")}}><div style={{fontWeight:600,color:"#fff",fontSize:14}}>{pj.name}</div><div style={{fontSize:12,color:"rgba(255,255,255,0.4)",marginTop:2}}>{(pj.totalSqFt||0).toLocaleString()} sf · {pj.bedrooms}bd/{pj.bathrooms}ba</div></div><div style={{display:"flex",gap:8}}><button onClick={()=>{setP(pj);setStp(0);setScr("builder")}} style={{...S.bt,...S.bs,...S.bsm}}>Edit</button><button onClick={()=>{if(confirm("Delete?"))delProj(pj.id)}} style={{...S.bt,...S.bd,...S.bsm}}>Del</button></div></div>)}</div>}</div></div>;

  if(scr==="builder"&&P){const p=P,reg=REGIONS.find(r=>r.id===p.region)||REGIONS[0];
  return<div style={S.app}><div style={S.bg}/><div style={S.ct}><div style={S.hd}><div style={S.lg} onClick={()=>setScr("home")}><div style={S.li}><HomeIcon size={22}/></div><div><div style={S.lt}>BuildCost Pro</div><div style={S.ls}>{p.name}</div></div></div><button onClick={()=>setScr("home")} style={{...S.bt,...S.bs,...S.bsm}}><ChevronLeft size={14}/> Back</button></div>
  <div style={S.tb}><div><div style={{fontSize:12,color:"rgba(255,255,255,0.4)",fontWeight:600,textTransform:"uppercase"}}>Total</div><div style={{fontSize:28,fontWeight:800,color:"#fff"}}>{fmt(total)}</div></div><div style={{textAlign:"right"}}><div style={{fontSize:12,color:"rgba(255,255,255,0.4)"}}>Per SF</div><div style={{fontSize:20,fontWeight:700,color:"#60a5fa"}}>{fmt(perSqFt)}/sf</div></div></div>
  <div style={{display:"flex",alignItems:"center",gap:6,margin:"20px 0 8px",flexWrap:"wrap"}}>{STEPS.map((s,i)=><div key={s.id} style={{display:"flex",alignItems:"center",gap:6}}><div onClick={()=>setStp(i)} style={{...S.sd,...(i===stp?S.sa:i<stp?S.sdn:S.sp)}}>{i<stp?<CheckIcon size={14}/>:s.icon}</div><span style={{fontSize:11,color:i===stp?"#fff":"rgba(255,255,255,0.3)",fontWeight:i===stp?600:400,marginRight:4}}>{s.label}</span>{i<STEPS.length-1&&<div style={{width:12,height:1,background:"rgba(255,255,255,0.1)"}}/>}</div>)}</div>
  <div style={S.pb}><div style={{...S.pf,width:`${((stp+1)/STEPS.length)*100}%`}}/></div>

  {stp===0&&<div><h3 style={S.st}><span style={{color:"#60a5fa"}}>01</span> Project Basics</h3><div style={S.cd}><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16}}><div style={{gridColumn:"1/-1"}}><label style={S.lb}>Project Name</label><input style={S.ip} value={p.name} onChange={e=>up({name:e.target.value})}/></div><div><label style={S.lb}>Living Sq Ft</label><input style={S.ip} type="number" value={p.totalSqFt} onChange={e=>up({totalSqFt:parseInt(e.target.value)||0,roofSqFt:Math.round((parseInt(e.target.value)||0)*1.15)})}/></div><div><label style={S.lb}>Stories</label><input style={S.ip} type="number" min="1" max="4" value={p.stories} onChange={e=>up({stories:parseInt(e.target.value)||1})}/></div><div><label style={S.lb}>Bedrooms</label><input style={S.ip} type="number" value={p.bedrooms} onChange={e=>up({bedrooms:parseInt(e.target.value)||1})}/></div><div><label style={S.lb}>Full Baths</label><input style={S.ip} type="number" value={p.bathrooms} onChange={e=>up({bathrooms:parseInt(e.target.value)||1})}/></div><div><label style={S.lb}>Half Baths</label><input style={S.ip} type="number" value={p.halfBaths} onChange={e=>up({halfBaths:parseInt(e.target.value)||0})}/></div><div><label style={S.lb}>Windows</label><input style={S.ip} type="number" value={p.windowCount} onChange={e=>up({windowCount:parseInt(e.target.value)||0})}/></div></div></div><div style={S.cd}><label style={S.lb}><MapPinIcon size={14}/> Location</label><OptSel options={REGIONS} value={p.region} onChange={v=>{const r=REGIONS.find(x=>x.id===v);up({region:v,isWaterfront:r?.waterfront||p.isWaterfront})}}/>{p.region==="custom"&&<div style={{marginTop:12}}><label style={S.lb}>Labor Multiplier</label><input style={{...S.ip,width:150}} type="number" step="0.05" value={p.customLaborMult} onChange={e=>up({customLaborMult:parseFloat(e.target.value)||1})}/></div>}<div style={{marginTop:16}}><label style={{display:"flex",alignItems:"center",gap:8,cursor:"pointer",fontSize:14}}><input type="checkbox" checked={p.isWaterfront} onChange={e=>up({isWaterfront:e.target.checked})} style={{width:18,height:18}}/><span style={{color:"#e8ecf1",fontWeight:600}}>Waterfront</span><span style={{...S.bg1,...S.ba}}>+15%</span></label></div></div></div>}

  {stp===1&&<div><h3 style={S.st}><span style={{color:"#60a5fa"}}>02</span> Exterior & Structure</h3><div style={S.cd}><label style={S.lb}>Foundation</label><OptSel options={FOUNDATION_TYPES} value={p.foundation} onChange={v=>up({foundation:v})}/></div><div style={S.cd}><label style={S.lb}>Framing</label><OptSel options={FRAMING} value={p.framing} onChange={v=>up({framing:v})}/></div><div style={S.cd}><label style={S.lb}>Roofing ({(p.roofSqFt||0).toLocaleString()} sf)</label><input style={{...S.ip,width:180,marginBottom:10}} type="number" value={p.roofSqFt} onChange={e=>up({roofSqFt:parseInt(e.target.value)||0})}/><OptSel options={ROOFING} value={p.roofing} onChange={v=>up({roofing:v})}/></div><div style={S.cd}><label style={S.lb}>Siding</label><OptSel options={EXTERIOR_SIDING} value={p.siding} onChange={v=>up({siding:v})}/></div><div style={S.cd}><label style={S.lb}>Windows ({p.windowCount})</label><OptSel options={WINDOWS} value={p.windows} onChange={v=>up({windows:v})}/></div><div style={S.cd}><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:16}}><div><label style={S.lb}>Ext Doors</label><input style={S.ip} type="number" value={p.exteriorDoors} onChange={e=>up({exteriorDoors:parseInt(e.target.value)||0})}/></div><div><label style={S.lb}>Garage Doors</label><input style={S.ip} type="number" value={p.garageDoors} onChange={e=>up({garageDoors:parseInt(e.target.value)||0})}/></div><div><label style={S.lb}>Int Doors</label><input style={S.ip} type="number" value={p.interiorDoors} onChange={e=>up({interiorDoors:parseInt(e.target.value)||0})}/></div></div></div></div>}

  {stp===2&&<div><h3 style={S.st}><span style={{color:"#60a5fa"}}>03</span> Rooms</h3><p style={{color:"rgba(255,255,255,0.4)",fontSize:13,margin:"-8px 0 16px"}}>Tap each room to configure.</p>{p.rooms.map(r=><RoomCfg key={r.id} room={r} onChange={u=>upRoom(r.id,u)} onRemove={()=>rmRoom(r.id)}/>)}<div style={{...S.cd,padding:16,marginTop:12}}><label style={S.lb}>Add Room</label><div style={{display:"flex",flexWrap:"wrap",gap:8}}>{Object.entries(ROOM_TEMPLATES).filter(([id])=>!p.rooms.some(r=>r.templateId===id)).slice(0,12).map(([id,t])=><button key={id} onClick={()=>addRoom(id)} style={{...S.bt,...S.bs,...S.bsm}}><PlusIcon size={14}/> {t.label}</button>)}</div></div></div>}

  {stp===3&&<div><h3 style={S.st}><span style={{color:"#60a5fa"}}>04</span> Interior Finishes</h3><div style={S.cd}><label style={S.lb}>Paint (~{Math.round(p.totalSqFt*3.2).toLocaleString()} sf)</label><OptSel options={PAINT_OPTIONS} value={p.paint} onChange={v=>up({paint:v})}/></div><div style={S.cd}><label style={S.lb}>Trim (~{Math.round(p.totalSqFt*1.5).toLocaleString()} lf)</label><OptSel options={MOLDING_OPTIONS} value={p.molding} onChange={v=>up({molding:v})}/></div><div style={S.cd}><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16}}><div><label style={S.lb}>Int Doors</label><input style={S.ip} type="number" value={p.interiorDoors} onChange={e=>up({interiorDoors:parseInt(e.target.value)||0})}/></div><div><label style={S.lb}>$/Door</label><input style={S.ip} type="number" value={p.interiorDoorCost} onChange={e=>up({interiorDoorCost:parseInt(e.target.value)||0})}/></div></div></div></div>}

  {stp===4&&<div><h3 style={S.st}><span style={{color:"#60a5fa"}}>05</span> Systems & Site</h3><div style={S.cd}><label style={S.lb}>Electrical</label><OptSel options={ELECTRICAL_LEVELS} value={p.electrical} onChange={v=>up({electrical:v})}/></div><div style={S.cd}><label style={S.lb}>HVAC</label><OptSel options={HVAC_OPTIONS} value={p.hvac} onChange={v=>up({hvac:v})}/></div><div style={S.cd}><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16}}><div><label style={S.lb}>Plumbing $</label><input style={S.ip} type="number" value={p.plumbing} onChange={e=>up({plumbing:parseInt(e.target.value)||0})}/></div><div><label style={S.lb}>Insulation $</label><input style={S.ip} type="number" value={p.insulation} onChange={e=>up({insulation:parseInt(e.target.value)||0})}/></div></div></div><div style={S.cd}><label style={S.lb}>Driveway ({p.drivewayLength} lf)</label><input style={{...S.ip,width:180,marginBottom:10}} type="number" value={p.drivewayLength} onChange={e=>up({drivewayLength:parseInt(e.target.value)||0})}/><OptSel options={DRIVEWAY_OPTIONS} value={p.driveway} onChange={v=>up({driveway:v})}/></div><div style={S.cd}><label style={S.lb}>Water/Sewer</label><OptSel options={WELL_SEPTIC} value={p.wellSeptic} onChange={v=>up({wellSeptic:v})}/></div><div style={S.cd}><label style={S.lb}>Permits & Fees</label><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:16}}><div><label style={{...S.lb,fontSize:11}}>Permits</label><input style={S.ip} type="number" value={p.permitCost??Math.round(reg.permitBase*(p.isWaterfront?1.15:1))} onChange={e=>up({permitCost:parseInt(e.target.value)||0})}/></div><div><label style={{...S.lb,fontSize:11}}>Inspect</label><input style={S.ip} type="number" value={p.inspectionCost} onChange={e=>up({inspectionCost:parseInt(e.target.value)||0})}/></div><div><label style={{...S.lb,fontSize:11}}>Architect</label><input style={S.ip} type="number" value={p.architectCost??(p.totalSqFt*5)} onChange={e=>up({architectCost:parseInt(e.target.value)||0})}/></div></div></div></div>}

  {stp===5&&costs&&<div><h3 style={S.st}><span style={{color:"#60a5fa"}}>06</span> Cost Summary</h3><div style={{...S.tb,marginBottom:20}}><div><div style={{fontSize:11,color:"rgba(255,255,255,0.4)",fontWeight:600,textTransform:"uppercase"}}>Grand Total</div><div style={{fontSize:36,fontWeight:800,color:"#fff"}}>{fmt(total)}</div><div style={{fontSize:13,color:"rgba(255,255,255,0.4)"}}>{(p.totalSqFt||0).toLocaleString()} sf · {p.bedrooms}bd/{p.bathrooms}ba · {reg.label}</div></div><div style={{textAlign:"right"}}><div style={{fontSize:24,fontWeight:700,color:"#60a5fa"}}>{fmt(perSqFt)}</div><div style={{fontSize:12,color:"rgba(255,255,255,0.4)"}}>per sf</div></div></div>
  <div style={S.cd}><h4 style={{fontSize:15,fontWeight:700,color:"#fff",margin:"0 0 12px"}}>Breakdown</h4>{Object.entries(costs).filter(([k])=>k!=="rooms").map(([k,v])=><div key={k} style={S.cl}><span style={{fontSize:14,color:"rgba(255,255,255,0.7)"}}>{v.label}</span><span style={{fontSize:14,fontWeight:700,color:"#fff"}}>{fmt(v.cost)}</span></div>)}<div style={{...S.cl,borderTop:"2px solid rgba(56,152,236,0.3)",borderBottom:"none",marginTop:8,paddingTop:12}}><span style={{fontSize:14,fontWeight:700,color:"#60a5fa"}}>Non-Room Subtotal</span><span style={{fontSize:14,fontWeight:700,color:"#60a5fa"}}>{fmt(Object.entries(costs).filter(([k])=>k!=="rooms").reduce((s,[,v])=>s+v.cost,0))}</span></div></div>
  <div style={S.cd}><h4 style={{fontSize:15,fontWeight:700,color:"#fff",margin:"0 0 12px"}}>Room Costs</h4>{roomBreakdown?.map((rm,i)=><div key={i} style={{marginBottom:12,paddingBottom:12,borderBottom:"1px solid rgba(255,255,255,0.04)"}}><div style={S.cl}><span style={{fontSize:14,fontWeight:600,color:"#fff"}}>{rm.label}</span><span style={{fontSize:14,fontWeight:700,color:"#c084fc"}}>{fmt(rm.cost)}</span></div>{rm.items.map((it,j)=><div key={j} style={{display:"flex",justifyContent:"space-between",padding:"3px 0 3px 20px"}}><span style={{fontSize:12,color:"rgba(255,255,255,0.4)"}}>{it.label}</span><span style={{fontSize:12,color:"rgba(255,255,255,0.5)"}}>{fmt(it.cost)}</span></div>)}</div>)}<div style={{...S.cl,borderTop:"2px solid rgba(168,85,247,0.3)",borderBottom:"none",marginTop:8,paddingTop:12}}><span style={{fontSize:14,fontWeight:700,color:"#c084fc"}}>Room Total</span><span style={{fontSize:14,fontWeight:700,color:"#c084fc"}}>{fmt(costs.rooms?.cost)}</span></div></div>
  <div style={S.cd}><label style={S.lb}>Notes</label><textarea style={{...S.ip,minHeight:100,resize:"vertical"}} value={p.notes||""} onChange={e=>up({notes:e.target.value})} placeholder="Notes..."/></div>
  <div style={{display:"flex",gap:12,marginTop:16,flexWrap:"wrap"}}><button onClick={()=>autoSave(P)} style={{...S.bt,...S.bp}}><SaveIcon/> Save</button><button onClick={()=>{const L=[`BuildCost Pro: ${p.name}`,`TOTAL: ${fmt(total)} (${fmt(perSqFt)}/sf)`,""]; Object.entries(costs).forEach(([k,v])=>{if(k==="rooms"){L.push("\n-- Rooms --");roomBreakdown?.forEach(rm=>{L.push("  "+rm.label+": "+fmt(rm.cost));rm.items.forEach(it=>L.push("    "+it.label+": "+fmt(it.cost)))})}else L.push(v.label+": "+fmt(v.cost))});navigator.clipboard?.writeText(L.join("\n")).then(()=>alert("Copied!"))}} style={{...S.bt,...S.bs}}><ClipboardIcon/> Copy</button></div></div>}

  <div style={{display:"flex",justifyContent:"space-between",padding:"24px 0 40px"}}><button onClick={()=>setStp(Math.max(0,stp-1))} disabled={stp===0} style={{...S.bt,...S.bs,opacity:stp===0?0.3:1,cursor:stp===0?"default":"pointer"}}><ChevronLeft/> Prev</button><button onClick={()=>setStp(Math.min(STEPS.length-1,stp+1))} disabled={stp===STEPS.length-1} style={{...S.bt,...S.bp,opacity:stp===STEPS.length-1?0.3:1,cursor:stp===STEPS.length-1?"default":"pointer"}}>{stp===STEPS.length-2?"Summary":"Next"} <ChevronRight/></button></div></div></div>}
  return null;
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
<script>setTimeout(function(){if(!document.querySelector('#root > div:not(#loading)')){document.getElementById('err').style.display='block';document.querySelector('.spin').style.display='none'}},15000)</script>
</body>
</html>